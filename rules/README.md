# Rules（ルール）

Claude Codeが常に従うべきルールやガイドラインを定義するディレクトリ。

## 概要

Rulesは、プロジェクト全体を通じてClaude Codeに守ってほしいルールや制約を定義します。これらは全てのセッションで自動的に適用されます。

## ルールとは

ルールファイルは`.claude/rules/`に配置され、Claude Codeのシステムプロンプトに自動的に追加されます。これにより、プロジェクト固有のコーディング規約や制約を常に適用できます。

## ルールファイルの構造

```markdown
# ルール名

## 概要
このルールの目的

## 適用範囲
どの場面で適用されるか

## ルール内容
具体的なルールの記述

## 例外
ルールの例外があれば記述
```

## ルールの種類（例）

### コーディング規約

#### coding-standards.md
```markdown
# コーディング規約

## TypeScript/JavaScript

### 命名規則
- 変数名: camelCase
- 定数: UPPER_SNAKE_CASE
- コンポーネント: PascalCase
- ファイル名: kebab-case

### コードスタイル
- インデント: 2スペース
- セミコロン: 必須
- 引用符: シングルクォート
- 行の長さ: 最大100文字

### 禁止事項
- `any`型の使用（型が不明な場合は`unknown`を使用）
- `console.log`の本番コードへのコミット
- 未使用の変数・インポート

### 推奨事項
- 関数は10行以内に保つ
- ファイルは200行以内に保つ
- 複雑度の高い関数は分割する
```

### Git規約

#### git-conventions.md
```markdown
# Git規約

## コミットメッセージ

### フォーマット
```
<type>: <subject>

<body>

<footer>
```

### Type
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響しない変更
- `refactor`: リファクタリング
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやツールの変更

### 例
```
feat: タイマー機能にバックグラウンド対応を追加

タイマーがアプリがバックグラウンドに移行しても
継続して動作するように実装。

Closes #123
```

## ブランチ命名

- `feature/機能名`: 新機能
- `fix/バグ内容`: バグ修正
- `refactor/対象`: リファクタリング
- `docs/内容`: ドキュメント更新
```

### セキュリティ

#### security-rules.md
```markdown
# セキュリティルール

## 禁止事項

### 1. 秘密情報のハードコード禁止
- APIキー
- パスワード
- トークン
- 秘密鍵

→ 環境変数を使用すること

### 2. SQL直接実行禁止
- 文字列連結によるSQL構築禁止
- 必ずプリペアドステートメントを使用

### 3. XSS対策必須
- ユーザー入力は必ずエスケープ
- `dangerouslySetInnerHTML`は禁止

### 4. 認証・認可
- 全APIエンドポイントで認証チェック
- 権限不足時は403を返す
- セッショントークンは安全に保管

## 推奨事項

- HTTPS通信のみ
- 最小権限の原則
- 定期的な依存関係の更新
- セキュリティヘッダーの設定
```

### テスト要件

#### testing-rules.md
```markdown
# テスト要件

## 必須テスト

### 1. ユニットテスト
- 全ての公開関数にテストを書く
- カバレッジ80%以上を維持
- エッジケースを含める

### 2. 統合テスト
- 全APIエンドポイントをテスト
- 認証フローをテスト
- データベース操作をテスト

### 3. E2Eテスト
- クリティカルユーザーフローをテスト
- 新機能には必ずE2Eテストを追加

## テスト記述ルール

### 命名規則
```typescript
describe('機能名', () => {
  it('期待される動作を説明', () => {
    // テストコード
  });
});
```

### AAA パターン
- Arrange: 準備
- Act: 実行
- Assert: 検証

### 禁止事項
- テストの相互依存
- ランダムな値の使用
- 外部サービスへの実際の通信
```

### パフォーマンス

#### performance-rules.md
```markdown
# パフォーマンスルール

## 必須要件

### アプリ起動
- 起動時間: 3秒以内
- 初回レンダリング: 1秒以内

### アニメーション
- 60fps維持必須
- ジャンクやカクつきなし

### API呼び出し
- レスポンス時間: 200ms以内（p95）
- タイムアウト: 10秒
- 適切なローディング表示

### バンドルサイズ
- 初期バンドル: 500KB以下
- レイジーローディング活用
- 未使用コードの削除

## 最適化手法

### React/React Native
- `React.memo`で不要な再レンダリング防止
- `useCallback`/`useMemo`の適切な使用
- リストには`key`を必ず指定
- 大きなリストは仮想化

### データベース
- 適切なインデックスを設定
- N+1クエリを回避
- ページネーション実装
```

## StudyMate用の推奨ルール

### studymate-core-principles.md
```markdown
# StudyMate コアプリンシプル

## プロダクト哲学

### 1. 「今日もやった自分」を静かに肯定
- 評価的な言葉を使わない
- 比較を促さない
- 小さな進捗も肯定する

### 2. サボった日を責めない
- 未記録日に否定的なメッセージを表示しない
- 連続記録が途切れても責めない
- 「空白」を許容するUI

### 3. 明日も机に戻りやすくする
- 記録完了まで15秒以内
- 1ステップで完了
- 再開のハードルを極端に下げる

## 技術的制約

### 非機能要件（必須）
- 記録完了: 最大15秒
- アプリ起動: 3秒以内
- アニメーション: 60fps
- オフライン対応: 必須
- クラウド同期: 必須

### UI/UX原則
- 継続のしやすさ > 情報の正確さ
- 気持ちの軽さ > 記録の網羅性
- 分かりやすさ > 自由度

## コード実装時の注意

### タイマー機能
- 精度: ±1秒/時間
- バックグラウンド継続: 必須
- STOP = 自動保存（確認ダイアログなし）

### データ同期
- オフラインファースト設計
- 競合解決は最終更新を優先
- ユーザーにデータ喪失を感じさせない

### エラーハンドリング
- ユーザーに分かりやすいメッセージ
- 技術的詳細は隠す
- 次のアクションを明示
```

## カスタムルールの作成

### 1. ルールファイルを作成

```bash
cd ~/workspace/claude_utilization/rules
touch my-rule.md
```

### 2. ルール内容を記述

```markdown
# ルール名

## 概要
ルールの目的と背景

## ルール内容
具体的なルールの記述

## 例
良い例と悪い例

## 例外
ルールの例外があれば
```

### 3. プロジェクトに適用

```bash
cd /path/to/your/project
bash ~/workspace/claude_utilization/setup.sh
```

## ベストプラクティス

### ルール設計

1. **具体的**: 抽象的でなく具体的なルールを記述
2. **理由を明記**: なぜそのルールが必要かを説明
3. **例を含める**: 良い例と悪い例を示す
4. **例外を明記**: ルールの例外があれば明確に

### ルールの粒度

- ルールごとに1つのファイル
- 関連するルールはグループ化
- 大きすぎるルールは分割

### 優先順位

ルールファイル名に番号を付けて優先順位を示すことも可能：

```
01-core-principles.md      # 最優先
02-coding-standards.md
03-security-rules.md
99-optional-guidelines.md  # 任意のガイドライン
```

## ルールの適用確認

Claude Codeは`.claude/rules/`内の全てのMarkdownファイルを読み込みます。

ルールが適用されているか確認：

```plaintext
プロジェクトのルールを確認して、現在のコードが準拠しているかチェックしてください。
```

## 現在の状態

このディレクトリは現在空です。プロジェクトのニーズに応じてルールを追加できます。

## 参考リンク

- [../README.md](../README.md) - フレームワーク全体の説明
- [../examples/](../examples/) - 設定例
